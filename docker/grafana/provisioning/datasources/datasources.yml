# Grafana Data Sources Provisioning
# This automatically configures Prometheus and Loki as data sources
# Learn more: https://grafana.com/docs/grafana/latest/administration/provisioning/

apiVersion: 1

datasources:
  # ============================================================
  # Prometheus - for metrics
  # ============================================================
  - name: Prometheus
    type: prometheus
    uid: prometheus
    access: proxy
    url: http://prometheus:9090
    orgId: 1
    isDefault: true
    editable: true
    jsonData:
      timeInterval: "15s"

  # ============================================================
  # Loki - for logs
  # ============================================================
  - name: Loki
    type: loki
    access: proxy
    url: http://loki:3100
    orgId: 1
    editable: true
    jsonData:
      maxLines: 1000

  # ============================================================
  # Tempo - for traces
  # ============================================================
  # Tempo stores distributed traces from our microservices.
  # We can search by trace ID or find traces from logs/metrics.
  - name: Tempo
    type: tempo
    access: proxy
    url: http://tempo:3200
    orgId: 1
    editable: true
    jsonData:
      # Enable trace-to-logs: click a trace span to see logs
      tracesToLogs:
        datasourceUid: loki
        tags: ["app"]
        filterByTraceID: true
        filterBySpanID: true
      # Enable trace-to-metrics: link traces to Prometheus
      tracesToMetrics:
        datasourceUid: prometheus
        tags: ["service.name"]
      # Service graph shows service dependencies
      serviceMap:
        datasourceUid: prometheus
      # Node graph visualization
      nodeGraph:
        enabled: true
